/*!
 * Particleground
 *
 * @author Jonathan Nicol - @mrjnicol
 * @version 1.1.0
 * @description Creates a canvas based particle system background
 *
 * Inspired by http://requestlab.fr/ and http://disruptivebydesign.com/
 */
;(function(c,a){var e="particleground";function f(g){g=g||{};for(var j=1;j<arguments.length;j++){var k=arguments[j];if(!k){continue}for(var h in k){if(k.hasOwnProperty(h)){if(typeof k[h]==="object"){deepExtend(g[h],k[h])}else{g[h]=k[h]}}}}return g}var d=c.jQuery;function b(i,l){var A=!!a.createElement("canvas").getContext;var k;var x;var F=[];var H;var s=0;var p=0;var r;var y;var D=!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|mobi|tablet|opera mini|nexus 7)/i);var j=!!c.DeviceOrientationEvent;var w=0;var h;var g;var v=0;var E=false;l=f({},c[e].defaults,l);function z(){if(!A){return}k=a.createElement("canvas");k.className="pg-canvas";k.style.display="block";i.insertBefore(k,i.firstChild);x=k.getContext("2d");m();var I=Math.round((k.width*k.height)/l.density);for(var J=0;J<I;J++){var K=new B();K.setStackPos(J);F.push(K)}c.addEventListener("resize",function(){C()},false);a.addEventListener("mousemove",function(L){s=L.pageX;p=L.pageY},false);if(j&&!D){c.addEventListener("deviceorientation",function(){v=Math.min(Math.max(-event.beta,-30),30);w=Math.min(Math.max(-event.gamma,-30),30)},true)}t();q("onInit")}function m(){k.width=i.offsetWidth;k.height=i.offsetHeight;x.fillStyle=l.dotColor;x.strokeStyle=l.lineColor;x.lineWidth=l.lineWidth}function t(){if(!A){return}r=c.innerWidth;y=c.innerHeight;x.clearRect(0,0,k.width,k.height);for(var I=0;I<F.length;I++){F[I].updatePosition()}for(var I=0;I<F.length;I++){F[I].draw()}if(!E){H=requestAnimationFrame(t)}}function C(){m();var L=i.offsetWidth;var J=i.offsetHeight;for(var K=F.length-1;K>=0;K--){if(F[K].position.x>L||F[K].position.y>J){F.splice(K,1)}}var I=Math.round((k.width*k.height)/l.density);if(I>F.length){while(I>F.length){var M=new B();F.push(M)}}else{if(I<F.length){F.splice(I)}}for(K=F.length-1;K>=0;K--){F[K].setStackPos(K)}}function o(){E=true}function n(){E=false;t()}function B(){this.stackPos;this.active=true;this.layer=Math.ceil(Math.random()*3);this.parallaxOffsetX=0;this.parallaxOffsetY=0;this.position={x:Math.ceil(Math.random()*k.width),y:Math.ceil(Math.random()*k.height)};this.speed={};switch(l.directionX){case"left":this.speed.x=+(-l.maxSpeedX+(Math.random()*l.maxSpeedX)-l.minSpeedX).toFixed(2);break;case"right":this.speed.x=+((Math.random()*l.maxSpeedX)+l.minSpeedX).toFixed(2);break;default:this.speed.x=+((-l.maxSpeedX/2)+(Math.random()*l.maxSpeedX)).toFixed(2);this.speed.x+=this.speed.x>0?l.minSpeedX:-l.minSpeedX;break}switch(l.directionY){case"up":this.speed.y=+(-l.maxSpeedY+(Math.random()*l.maxSpeedY)-l.minSpeedY).toFixed(2);break;case"down":this.speed.y=+((Math.random()*l.maxSpeedY)+l.minSpeedY).toFixed(2);break;default:this.speed.y=+((-l.maxSpeedY/2)+(Math.random()*l.maxSpeedY)).toFixed(2);this.speed.x+=this.speed.y>0?l.minSpeedY:-l.minSpeedY;break}}B.prototype.draw=function(){x.beginPath();x.arc(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY,l.particleRadius/2,0,Math.PI*2,true);x.closePath();x.fill();x.beginPath();for(var K=F.length-1;K>this.stackPos;K--){var L=F[K];var J=this.position.x-L.position.x;var I=this.position.y-L.position.y;var M=Math.sqrt((J*J)+(I*I)).toFixed(2);if(M<l.proximity){x.moveTo(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY);if(l.curvedLines){x.quadraticCurveTo(Math.max(L.position.x,L.position.x),Math.min(L.position.y,L.position.y),L.position.x+L.parallaxOffsetX,L.position.y+L.parallaxOffsetY)}else{x.lineTo(L.position.x+L.parallaxOffsetX,L.position.y+L.parallaxOffsetY)}}}x.stroke();x.closePath()};B.prototype.updatePosition=function(){if(l.parallax){if(j&&!D){var I=(r-0)/(30- -30);h=(w- -30)*I+0;var L=(y-0)/(30- -30);g=(v- -30)*L+0}else{h=s;g=p}this.parallaxTargX=(h-(r/2))/(l.parallaxMultiplier*this.layer);this.parallaxOffsetX+=(this.parallaxTargX-this.parallaxOffsetX)/10;this.parallaxTargY=(g-(y/2))/(l.parallaxMultiplier*this.layer);this.parallaxOffsetY+=(this.parallaxTargY-this.parallaxOffsetY)/10}var K=i.offsetWidth;var J=i.offsetHeight;switch(l.directionX){case"left":if(this.position.x+this.speed.x+this.parallaxOffsetX<0){this.position.x=K-this.parallaxOffsetX}break;case"right":if(this.position.x+this.speed.x+this.parallaxOffsetX>K){this.position.x=0-this.parallaxOffsetX}break;default:if(this.position.x+this.speed.x+this.parallaxOffsetX>K||this.position.x+this.speed.x+this.parallaxOffsetX<0){this.speed.x=-this.speed.x}break}switch(l.directionY){case"up":if(this.position.y+this.speed.y+this.parallaxOffsetY<0){this.position.y=J-this.parallaxOffsetY}break;case"down":if(this.position.y+this.speed.y+this.parallaxOffsetY>J){this.position.y=0-this.parallaxOffsetY}break;default:if(this.position.y+this.speed.y+this.parallaxOffsetY>J||this.position.y+this.speed.y+this.parallaxOffsetY<0){this.speed.y=-this.speed.y}break}this.position.x+=this.speed.x;this.position.y+=this.speed.y};B.prototype.setStackPos=function(I){this.stackPos=I};function u(I,J){if(J){l[I]=J}else{return l[I]}}function G(){console.log("destroy");k.parentNode.removeChild(k);q("onDestroy");if(d){d(i).removeData("plugin_"+e)}}function q(I){if(l[I]!==undefined){l[I].call(i)}}z();return{option:u,destroy:G,start:n,pause:o}}c[e]=function(h,g){return new b(h,g)};c[e].defaults={minSpeedX:0.1,maxSpeedX:0.1,minSpeedY:0.1,maxSpeedY:0.1,directionX:"center",directionY:"center",density:10000,dotColor:"#666666",lineColor:"#666666",particleRadius:1,lineWidth:1,curvedLines:true,proximity:350,parallax:false,parallaxMultiplier:5000,onInit:function(){},onDestroy:function(){}};if(d){d.fn[e]=function(i){if(typeof arguments[0]==="string"){var g=arguments[0];var h=Array.prototype.slice.call(arguments,1);var j;this.each(function(){if(d.data(this,"plugin_"+e)&&typeof d.data(this,"plugin_"+e)[g]==="function"){j=d.data(this,"plugin_"+e)[g].apply(this,h)}});if(j!==undefined){return j}else{return this}}else{if(typeof i==="object"||!i){return this.each(function(){if(!d.data(this,"plugin_"+e)){d.data(this,"plugin_"+e,new b(this,i))}})}}}}})(window,document);(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());